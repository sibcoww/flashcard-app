<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ì–ª–∞–≤–Ω–∞—è</title>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 2px solid #0ff;
    }

    .tab {
      padding: 10px 20px;
      cursor: pointer;
      background-color: #222;
      border-radius: 10px 10px 0 0;
      margin-right: 10px;
      color: #0ff;
      transition: background 0.3s;
    }

    .tab.active {
      background-color: #0ff;
      color: #000;
      font-weight: bold;
    }

    .tab:hover {
      background-color: #00cccc;
      color: #000;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    button {
      margin-top: 15px;
      padding: 10px 20px;
      background-color: #0ff;
      color: #121212;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 15px;
      font-weight: bold;
      transition: 0.3s ease;
      box-shadow: 0 0 10px #0ff;
    }

    button:hover {
      background-color: #00cccc;
      box-shadow: 0 0 20px #0ff;
    }

    input {
      padding: 10px;
      margin: 8px 0;
      width: 100%;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      background-color: #1e1e1e;
      color: #f5f5f5;
      outline: none;
    }

    #categoryList button {
      margin: 5px;
    }
  </style>
</head>
<body>

<header>
  <h1>–ö–∞—Ä—Ç–æ—á–∫–∏</h1>
  <button onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
</header>

<div class="tabs">
  <div class="tab active" onclick="showTab('create')">üìÑ –°–æ–∑–¥–∞–Ω–∏–µ</div>
  <div class="tab" onclick="showTab('categories')">üóÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
</div>

<!-- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ -->
<div id="create" class="section active">
  <form id="cardForm">
    <input type="text" id="question" placeholder="–í–æ–ø—Ä–æ—Å" required>
    <input type="text" id="answer" placeholder="–û—Ç–≤–µ—Ç" required>
    <input type="text" id="category" placeholder="–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–Ω–∞–ø—Ä. –ê–Ω–≥–ª–∏–π—Å–∫–∏–π)" required>
    <button type="submit">–°–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
  </form>
</div>

<!-- ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
<div id="categories" class="section">
  <h2>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h2>
  <div id="categoryList"></div>
</div>

<script>
  const username = localStorage.getItem("username");
  if (!username) {
    alert("–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã");
    window.location.href = "login.html";
  }

  // –í–∫–ª–∞–¥–∫–∏
  function showTab(id) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelector(`.tab[onclick="showTab('${id}')"]`).classList.add('active');
  }

  // –í—ã—Ö–æ–¥
  function logout() {
    localStorage.removeItem("username");
    window.location.href = "login.html";
  }

  // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
  document.getElementById("cardForm").addEventListener("submit", function (e) {
    e.preventDefault();
    const question = document.getElementById("question").value;
    const answer = document.getElementById("answer").value;
    const category = document.getElementById("category").value;

    fetch("api/cards", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ question, answer, category, createdByUsername: username })
    }).then(res => {
      if (res.ok) {
        loadCategories();
        e.target.reset();
      } else {
        alert("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏");
      }
    });
  });

  // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
  function loadCategories() {
    fetch("api/cards/categories")
            .then(res => res.json())
            .then(categories => {
              const container = document.getElementById("categoryList");
              container.innerHTML = "";
              categories.forEach(cat => {
                const btn = document.createElement("button");
                btn.textContent = cat;
                btn.onclick = () => {
                  window.location.href = `practice.html?category=${encodeURIComponent(cat)}`;
                };
                container.appendChild(btn);
              });
            });
  }

  loadCategories();
</script>

</body>
</html>
